**论文地址**：[https://arxiv.org/pdf/2205.10249](https://arxiv.org/pdf/2205.10249)

**名词解释**：
- SDIM：**S**ampling-based **D**eep **I**nterest **M**odeling，基于采样的深度兴趣网络；
- BSE：**B**ehavior **S**equence **E**ncoding，行为序列编码

**问题背景**：
- 丰富的用户行为数据对于建模 CTR 预估任务有非常大的简直，但是由于在线的响应等问题全部使用 long-term 的行为是很难实现的；
- 过去的一些工作主要是采用 **基于检索** 的的策略，检索出一小部分用户行为 用于后续的注意力机制，该方法存在如下缺点：
	- 这种方式容易得到次优解，会造成**信息损失**。
	- 会对用户的长期兴趣产生**估计偏差**，特别的，在一些用户行为非常丰富的场景，检索出来的 top-k 的结果可能都和候选结果相似，这样表达出来的用户长期兴趣是不准的。
	- 很难衡量性能和效率。

**基本思想**：
- 通过使用 LSH 的碰撞概率来近似 softmax 的分布！！！！这样算法表现为在原始的长序列上进行注意力机制，因此可以取到更好的效果。

**论文贡献**：
- 本文提出了一个 SDIM 模型，一个简单并且高效的 基于采样的端到端 的建模 long-term 用户行为的方法；
- 该方法通过哈希函数将候选和历史行为生成签名之后，直接聚合和候选结果存在相同哈新签名的行为，我们从理论和实践上证明这种方式和标准的注意力机制的**效果相当**；
- 文中将用户序列哈希和 CTR 建模 通过设计的一个 称为BSE的分离模块解耦。

**模型结构**：
![[Pasted image 20240529210315.png|800]]

**BSE: Behavior Sequence Hashing**：
>由于这个模块是最耗时的，而这部分和主模型可以分离部署，因此可以大幅降低 serving 时间.

![[Pasted image 20240529220939.png|800]]

如上图是 (4-2) simHash，总共4个哈希函数，每两个一组，分别用 $m$ 和 $\tau$ 表示，则
$$
\begin{align}
&\text{Attn}(\text{q},\text{S})=\frac{1}{m/\tau}\sum_{i=1}^{m/\tau}l_{2}\left(\tilde{\text{p}}^{(\text{R}_{i})}\text{S}\right)=\frac{1}{m/\tau}\sum_{i=1}^{m/\tau}l_{2}\left(\sum_{j=1}^{L}\tilde{p}_{j}^{\text{R}_{i}}s_{j}\right) \\
&\tilde{p}^{(\text{R})}=p^{(r_{1})}\&p^{(r_{2})}\&\cdots\&p^{(\text{r}_{\tau})}=\&_{k=1}^{\tau}p^{(\text{r}_{k})} \\
&p^{(\text{r})}=1_{h(\text{x}_{1},\text{r})=h(\text{x}_{2},r)}
\end{align}
$$
此处的理解：
1. $h(\text{x},\text{r})=\text{sign}(\text{r}^{T}\text{x})$ 表示输入向量 $\text{x}$ 在 哈希函数 $\text{r}$ 作用下的哈希值，具体实现为 哈希向量和 输入向量内积结果通过 sign 函数的值；
2. $\tilde{p}^{(\text{R})}$ 代表所有 $\tau$ 个哈希函数值得到的结果均相等，即 分组哈希值相等，例如 图示中 $s_{0}$ 和 $s_{1}$ 在第一个 哈希分组中 都得到了 (1, -1) 的结果，因此相等；
3. $l_{2}$ 代表 归一化方法，即 向量 $\displaystyle \frac{\text{x}}{{\Vert\text{x}\Vert}_{2}}$. 具体可以看图示会更清晰！

**参数设置**：
- 最后 m = 48，即哈希函数的个数
- $\tau=3$，即每三个哈希函数一组，总共16组

**策略收益**：
- CTR +2.98%，VBR+2.69% (Visited-Buy Rate).

**性能对比**：
![[Pasted image 20240530103827.png]]

**个人思考**：
- 文中比较了 $l_{2}$ 归一化和 均值归一化的方法，得到的效果相当，因为 $l_{2}$ 归一化效率更快，所以使用了 $l_{2}$ 归一化，但是 $l_{2}$ 得到的是单位向量，并不能使权重总和为1？
![[Pasted image 20240530103310.png|500]]
![[Pasted image 20240530103318.png]]

